(self["webpackChunklightandnight"]=self["webpackChunklightandnight"]||[]).push([[990],{9341:function(t,e,i){"use strict";var a=i(7293);t.exports=function(t,e){var i=[][t];return!!i&&a((function(){i.call(null,e||function(){return 1},1)}))}},3671:function(t,e,i){var a=i(9662),s=i(7908),n=i(8361),l=i(6244),o=TypeError,r=function(t){return function(e,i,r,c){a(i);var m=s(e),h=n(m),u=l(m),d=t?u-1:0,g=t?-1:1;if(r<2)while(1){if(d in h){c=h[d],d+=g;break}if(d+=g,t?d<0:u<=d)throw o("Reduce of empty array with no initial value")}for(;t?d>=0:u>d;d+=g)d in h&&(c=i(c,h[d],d,m));return c}};t.exports={left:r(!1),right:r(!0)}},5827:function(t,e,i){"use strict";var a=i(2109),s=i(3671).left,n=i(9341),l=i(7392),o=i(5268),r=n("reduce"),c=!o&&l>79&&l<83;a({target:"Array",proto:!0,forced:!r||c},{reduce:function(t){var e=arguments.length;return s(this,t,e,e>1?arguments[1]:void 0)}})},6911:function(){},3254:function(){},3737:function(){},5990:function(t,e,i){"use strict";i.r(e),i.d(e,{default:function(){return it}});var a=i(458),s=i(6252),n=i(3759),l=i(293),o=i(8443),r=i(5314),c=i(8217),m=i(4548),h=i(1116),u=i(3229);const[d,g]=(0,n["do"])("action-sheet"),w=(0,l.l7)({},u.W,{title:String,round:o.J5,actions:(0,o.Ce)(),closeIcon:(0,o.SQ)("cross"),closeable:o.J5,cancelText:String,description:String,closeOnPopstate:o.J5,closeOnClickAction:Boolean,safeAreaInsetBottom:o.J5}),f=[...u.m,"round","closeOnPopstate","safeAreaInsetBottom"];var p=(0,s.aZ)({name:d,props:w,emits:["select","cancel","update:show"],setup(t,{slots:e,emit:i}){const a=t=>i("update:show",t),n=()=>{a(!1),i("cancel")},o=()=>{if(t.title)return(0,s.Wm)("div",{class:g("header")},[t.title,t.closeable&&(0,s.Wm)(c.J,{name:t.closeIcon,class:[g("close"),r.e9],onClick:n},null)])},u=()=>{if(e.cancel||t.cancelText)return[(0,s.Wm)("div",{class:g("gap")},null),(0,s.Wm)("button",{type:"button",class:g("cancel"),onClick:n},[e.cancel?e.cancel():t.cancelText])]},d=(t,i)=>t.loading?(0,s.Wm)(h.g,{class:g("loading-icon")},null):e.action?e.action({action:t,index:i}):[(0,s.Wm)("span",{class:g("name")},[t.name]),t.subname&&(0,s.Wm)("div",{class:g("subname")},[t.subname])],w=(e,n)=>{const{color:l,loading:o,callback:r,disabled:c,className:m}=e,h=()=>{c||o||(r&&r(e),t.closeOnClickAction&&a(!1),(0,s.Y3)((()=>i("select",e,n))))};return(0,s.Wm)("button",{type:"button",style:{color:l},class:[g("item",{loading:o,disabled:c}),m],onClick:h},[d(e,n)])},p=()=>{if(t.description||e.description){const i=e.description?e.description():t.description;return(0,s.Wm)("div",{class:g("description")},[i])}};return()=>(0,s.Wm)(m.G,(0,s.dG)({class:g(),position:"bottom","onUpdate:show":a},(0,l.ei)(t,f)),{default:()=>{var i;return[o(),p(),(0,s.Wm)("div",{class:g("content")},[t.actions.map(w),null==(i=e.default)?void 0:i.call(e)]),u()]}})}});const v=(0,a.n)(p);i(1958),i(368),i(6742),i(2939),i(6196),i(2666);var k=i(83),b=(i(2130),i(4377)),x=(i(2278),i(6068)),W=(i(2087),i(1046)),y=(i(6186),i(9850)),S=(i(5124),i(9530)),_=(i(6616),i(4871)),$=(i(2563),i(7419)),C=(i(470),i(7036)),P=(i(158),i(4481)),T=(i(4762),i(6773)),M=(i(6911),i(2639));const[A,I]=(0,n["do"])("progress"),F={color:String,inactive:Boolean,pivotText:String,textColor:String,showPivot:o.J5,pivotColor:String,trackColor:String,strokeWidth:o.Or,percentage:{type:o.Or,default:0,validator:t=>t>=0&&t<=100}};var U=(0,s.aZ)({name:A,props:F,setup(t){const e=(0,s.Fl)((()=>t.inactive?void 0:t.color)),i=()=>{const{textColor:i,pivotText:a,pivotColor:n,percentage:l}=t,o=null!=a?a:`${l}%`;if(t.showPivot&&o){const a={color:i,left:+l+"%",transform:`translate(-${+l}%,-50%)`,background:n||e.value};return(0,s.Wm)("span",{style:a,class:I("pivot",{inactive:t.inactive})},[o])}};return()=>{const{trackColor:a,percentage:n,strokeWidth:l}=t,o={background:a,height:(0,M.Nn)(l)},r={width:`${n}%`,background:e.value};return(0,s.Wm)("div",{class:I(),style:o},[(0,s.Wm)("span",{class:I("portion",{inactive:t.inactive}),style:r},null),i()])}}});const G=(0,a.n)(U);var D=i(5267),V=(i(1645),i(5160)),O=(i(6338),i(4958)),z=(i(6870),i(9963)),Y=i(3577);const B=["width","height"],R=["textContent"],H={class:"container"},J={class:"container"},N={key:0,class:"container"};function j(t,e,i,a,n,l){const o=c.J,r=O.Z,m=V.b,h=D.T,u=G,d=T.X,g=P.O,w=C.Y,f=$.E,p=_.v,M=S.m,A=y.J,I=W.X,F=x.i,U=b.Vq,j=k.i,K=v,q=(0,s.Q2)("t");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(r,{title:t.$t("route.wishsim"),"can-return":"",onClickRight:e[0]||(e[0]=t=>n.volumesShow=!0)},{default:(0,s.w5)((()=>[(0,s.Wm)(o,{name:"exchange"})])),_:1},8,["title"]),(0,s.Wm)(M,{active:n.active,"onUpdate:active":e[3]||(e[3]=t=>n.active=t),sticky:"","offset-top":"46"},{default:(0,s.w5)((()=>[(0,s.wy)((0,s._)("canvas",{id:"canvas",width:n.width,height:n.width},null,8,B),[[z.F8,0==n.active]]),(0,s.Wm)(g,{title:n.data[n.volume].name},{default:(0,s.w5)((()=>[(0,s.Wm)(h,{title:t.$t("common.gacha"),inset:""},{default:(0,s.w5)((()=>[l.remainGifts?((0,s.wg)(),(0,s.j4)(m,{key:0,title:t.$t("wishsim.gacha"),"is-link":"",onClick:l.gacha3Times},null,8,["title","onClick"])):((0,s.wg)(),(0,s.j4)(m,{key:1,title:t.$t("wishsim.complete",[t.gachaTime,n.data[n.volume].gift])},null,8,["title"]))])),_:1},8,["title"]),(0,s.Wm)(h,{title:t.$t("common.currentStatus"),inset:""},{default:(0,s.w5)((()=>[(0,s.Wm)(m,{title:t.$t("wishsim.possibility",[n.data[n.volume].gift]),value:l.giftPossibilityString,"is-link":"",onClick:e[1]||(e[1]=t=>n.possibilityShow=!0)},null,8,["title","value"]),(0,s.Wm)(m,null,{default:(0,s.w5)((()=>[(0,s.Uk)((0,Y.zw)(t.$t("wishsim.gachaTime"))+" ",1),(0,s.Wm)(u,{percentage:t.gachaTime/n.data[n.volume].must[2]*100,"pivot-text":`${t.gachaTime}`,"pivot-color":"#6c71c5",color:"linear-gradient(135deg, #6c71c5, #93a9da)"},null,8,["percentage","pivot-text"]),(0,s._)("small",{textContent:(0,Y.zw)(t.$t("wishsim.gachaTimeDesc",n.data[n.volume].must))},null,8,R)])),_:1})])),_:1},8,["title"]),(0,s.Wm)(h,{title:n.data[n.volume].gift,inset:""},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(t.gifts,(e=>((0,s.wg)(),(0,s.j4)(m,{key:e,title:e.name},{"right-icon":(0,s.w5)((()=>[e.time?((0,s.wg)(),(0,s.iD)(s.HY,{key:0},[(0,s.Uk)((0,Y.zw)(t.$t("wishsim.giftTime",[e.time])),1)],64)):(0,s.kq)("",!0),(0,s.Wm)(d,{modelValue:e.had,"onUpdate:modelValue":t=>e.had=t,disabled:""},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["title"])))),128))])),_:1},8,["title"])])),_:1},8,["title"]),(0,s.Wm)(g,{title:t.$t("common.settings")},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{modelValue:l.maxFrame,"onUpdate:modelValue":e[2]||(e[2]=t=>l.maxFrame=t)},{default:(0,s.w5)((()=>[(0,s.Wm)(h,{title:t.$t("wishsim.settings.maxFrame"),inset:""},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(n.maxFrames,(e=>((0,s.wg)(),(0,s.j4)(m,{key:e,title:t.$t(`wishsim.settings.maxFrames[${e}]`),clickable:"",onClick:t=>l.setMaxFrame(e)},{"right-icon":(0,s.w5)((()=>[(0,s.Wm)(w,{name:e},null,8,["name"])])),_:2},1032,["title","onClick"])))),128))])),_:1},8,["title"])])),_:1},8,["modelValue"]),0===n.volume?((0,s.wg)(),(0,s.j4)(h,{key:0,title:t.$t("wishsim.settings.weight"),inset:""},{default:(0,s.w5)((()=>[(0,s.Wm)(m,{title:t.$t("common.info"),icon:"question-o","is-link":"",onClick:l.showWeightInfo},null,8,["title","onClick"]),((0,s.wg)(),(0,s.iD)(s.HY,null,(0,s.Ko)([0,5],(t=>(0,s.Wm)(m,{key:t,title:n.rewards[t].name,center:""},{"right-icon":(0,s.w5)((()=>[(0,s.Wm)(p,{modelValue:n.rewards[t].weight,"onUpdate:modelValue":e=>n.rewards[t].weight=e,min:"140",max:"175","input-width":"48px"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["title"]))),64))])),_:1},8,["title"])):(0,s.kq)("",!0)])),_:1},8,["title"])])),_:1},8,["active"]),(0,s.Wm)(j,{"theme-vars":n.dialogTheme},{default:(0,s.w5)((()=>[(0,s.Wm)(U,{show:n.possibilityShow,"onUpdate:show":e[4]||(e[4]=t=>n.possibilityShow=t),closeOnClickOverlay:""},{default:(0,s.w5)((()=>[(0,s._)("div",H,[(0,s.Wm)(I,{class:"content center-row"},{default:(0,s.w5)((()=>[((0,s.wg)(),(0,s.iD)(s.HY,null,(0,s.Ko)([0,1,2],(t=>(0,s.Wm)(A,{key:t,span:"8"},{default:(0,s.w5)((()=>[(0,s.wy)((0,s._)("strong",null,null,512),[[q,`wishsim.possibilityTitle[${t}]`]])])),_:2},1024))),64))])),_:1}),(0,s.Wm)(F,{dashed:""}),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(n.rewards,((t,e)=>((0,s.wg)(),(0,s.j4)(I,{key:t,class:"content center-row"},{default:(0,s.w5)((()=>[(0,s.Wm)(A,{span:"8"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,Y.zw)(t.name),1)])),_:2},1024),(0,s.Wm)(A,{span:"8"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,Y.zw)(l.possibilitiesString[e]),1)])),_:2},1024),(0,s.Wm)(A,{span:"8"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,Y.zw)(t.remain),1)])),_:2},1024)])),_:2},1024)))),128))]),(0,s.Wm)(F),(0,s._)("div",J,[((0,s.wg)(),(0,s.iD)(s.HY,null,(0,s.Ko)([0,1],(e=>(0,s.Wm)(I,{key:e,class:"content"},{default:(0,s.w5)((()=>[(0,s.Wm)(A,{span:"24",class:"desc"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,Y.zw)(t.$t(`wishsim.possibilityDesc[${e}]`,[n.data[n.volume].gift])),1)])),_:2},1024)])),_:2},1024))),64))])])),_:1},8,["show"]),(0,s.Wm)(U,{show:n.itemsGotShow,"onUpdate:show":e[5]||(e[5]=t=>n.itemsGotShow=t),title:t.$t("wishsim.resultTitle"),closeOnClickOverlay:""},{default:(0,s.w5)((()=>[t.itemsGot?((0,s.wg)(),(0,s.iD)("div",N,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(t.itemsGot,(e=>((0,s.wg)(),(0,s.iD)("div",{class:"content",key:e},(0,Y.zw)(t.$t("wishsim.giftNumber",[e.name,e.count])),1)))),128))])):(0,s.kq)("",!0)])),_:1},8,["show","title"])])),_:1},8,["theme-vars"]),(0,s.Wm)(K,{show:n.volumesShow,"onUpdate:show":e[6]||(e[6]=t=>n.volumesShow=t),actions:n.volumes,"cancel-text":t.$t("common.back"),"close-on-click-action":"",onSelect:l.selectVolume},null,8,["show","actions","cancel-text","onSelect"])],64)}i(5827),i(3948);var K=i(1068),q=i(3939),Z=i(590);let E=i(9987),L={gachaTime:0,initialAngle_:Math.PI,initialAngle:Math.PI,angles_:[Math.PI,Math.PI,Math.PI],angles:[Math.PI,Math.PI,Math.PI],frame:0,maxFrame_:void 0,gifts:[0,1,2].map((t=>({name:E[E.length-1].gifts[t],count:1,remain:1,had:!1}))),itemsGot:[]},Q=(t,e,i,a)=>(t/=a/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e;var X={name:"WishSimulator",components:{[v.name]:v,[G.name]:G,Navbar:O.Z},data(){const{width:t}=(0,Z.iP)();return{...L,data:E,rewards:E[E.length-1].rewards.map((t=>({...t,name:this.$t(`items.${t.id}`)}))),active:0,volume:E.length-1,volumes:E.map(((t,e)=>({name:t.name,index:e}))),width:Math.min(t.value,425),maxFrames:[216,144,72,36,1],volumesShow:!1,itemsGotShow:!1,possibilityShow:!1,dialogTheme:{dialogFontSize:"var(--van-font-size-md)"}}},watch:{volume(t){Object.assign(this,{...L,gifts:[0,1,2].map((e=>({name:E[t].gifts[e],count:1,remain:1,had:!1}))),rewards:E[t].rewards.map((t=>({...t,name:this.$t(`items.${t.id}`)})))}),this.updateCanvas()}},computed:{totalWeight(){return this.rewards.reduce(((t,e)=>0!==e.remain?t+e.weight:t),0)},possibilities(){return this.rewards.map((t=>0===t.remain?0:t.weight/this.totalWeight))},possibilitiesString(){return this.possibilities.map((t=>Math.round(1e4*t)/100+"%"))},giftPossibilityString(){return Math.round(1e4*Math.pow(this.possibilities[0],3))/100+"%"},remainGifts(){return this.gifts.reduce(((t,e)=>t+e.remain),0)},shapeAngle(){return this.possibilities.map((t=>2*Math.PI*t))},beginAngle(){let t=[0];for(let e in this.shapeAngle)t.push(t[e]+this.shapeAngle[e]);return t},maxFrame:{get(){if(void 0===this.maxFrame_){var t;let e=null===(t=localStorage)||void 0===t?void 0:t.getItem("WishSimMaxFrame");return null!==e?Number(e):144}return this.maxFrame_},set(t){var e;this.maxFrame_=t,null===(e=localStorage)||void 0===e||e.setItem("WishSimMaxFrame",t)}}},mounted(){let t=document.getElementById("canvas"),e=t.getContext("2d"),i=t=>{let e=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/e},a=i(e);t.style.width=t.width+"px",t.style.height=t.height+"px",t.width=t.width*a,t.height=t.height*a,e.scale(a,a),this.updateCanvas(this.angles_)},methods:{showWeightInfo(){(0,K.vC)({...this.$root.dialogSettings,message:this.$t("hint.wishsim")})},selectVolume(t){this.volume=t.index},setMaxFrame(t){this.maxFrame=t,this.frame=0},gacha3Times(){if(this.frame&&this.frame<=this.maxFrame)return;if(this.gachaTime>E[this.volume].must[2])return;if(0==this.remainGifts)return;this.gachaTime+=1,this.initialAngle_=this.initialAngle,this.angles_=this.angles,this.initialAngle=2*Math.PI*Math.random();let t={},e=[],i=!0;for(let s=0;s<3;s++){let a=this.gacha1Time();0!=a&&(i=!1),t[a]?t[a].count+=this.rewards[a].count:t[a]={...this.rewards[a]},e.push(this.initialAngle+this.beginAngle[a]+this.shapeAngle[a]*Math.random())}this.frame=0,this.angles=e;let a=()=>{if(this.updateCanvas(),this.frame+=1,this.frame<=this.maxFrame)requestAnimationFrame(a);else{if(i&&(0,q.NU)({type:"success",message:this.$t("wishsim.notify.success",[E[this.volume].gift])}),!i)for(let t of[0,1,2])if(this.remainGifts==3-t&&this.gachaTime==E[this.volume].must[t]){i=!0,(0,q.NU)({type:"success",message:this.$t("wishsim.notify.protect",[E[this.volume].must[t],E[this.volume].gift])});break}if(i){let e=Math.random();for(let i in this.gifts){let a=this.gifts[i];if(0!=a.remain){if(e<=1/this.remainGifts){a.remain-=1,a.had=!0,a.time=this.gachaTime,t["gift"]=a;break}e-=1/this.remainGifts,this.updateCanvas()}}}this.itemsGot=t,this.itemsGotShow=!0}};return a(),t},gacha1Time(){let t=Math.random();for(let[e,i]of this.rewards.entries())if(0!==i.remain){if(t<=this.possibilities[e])return i.remain>0&&(i.remain-=1),e;t-=this.possibilities[e]}},updateCanvas(){let t=this.width,e=document.getElementById("canvas"),i=e.getContext("2d"),a=.5*t,s=.5*t,n=.3*t,l=.375*t,o=.015*t,r=[.1*t,.17*t,.24*t],c=Q(this.frame,this.initialAngle_,this.initialAngle-this.initialAngle_-10*Math.PI,this.maxFrame),m=this.angles.map(((t,e)=>Q(this.frame,this.angles_[e],t-this.angles_[e]+(6+4*e)*Math.PI,this.maxFrame)));i.clearRect(0,0,t,t),i.textAlign="center";for(let h in this.rewards){if(0===this.rewards[h].remain)continue;i.beginPath(),i.moveTo(a,s),i.arc(a,s,n,c+this.beginAngle[h],c+this.beginAngle[h]+this.shapeAngle[h]),i.closePath(),i.fillStyle=0==h?"#525997":"#2a2c42",i.strokeStyle="#b9bcc2",i.setLineDash([1,10]),i.fill(),i.stroke();let t=a+l*Math.cos(c+this.beginAngle[h]+this.shapeAngle[h]/2),e=s+l*Math.sin(c+this.beginAngle[h]+this.shapeAngle[h]/2);i.fillText(this.rewards[h].name,t,e),this.rewards[h].remain?i.fillText(`× ${this.rewards[h].count} × ${this.rewards[h].remain}`,t,e+12):i.fillText(`× ${this.rewards[h].count} × ∞`,t,e+12)}for(let h=0;h<3;h++)i.beginPath(),1==h?i.setLineDash([10,10]):i.setLineDash([]),i.arc(a,s,r[h],0,2*Math.PI),i.closePath(),i.stroke();i.strokeStyle="#fff",i.fillStyle="#e5ce9c";for(let h in m){i.beginPath();let t=a+r[h]*Math.cos(m[h]),e=s+r[h]*Math.sin(m[h]);i.arc(t,e,o,0,2*Math.PI),i.closePath(),i.fill(),i.stroke()}0==this.remainGifts&&(i.fillStyle="#fff",i.fillText(this.$t("wishsim.complete",[this.gachaTime,E[this.volume].gift]),a,s))}}},tt=i(3744);const et=(0,tt.Z)(X,[["render",j],["__scopeId","data-v-4a996fb2"]]);var it=et},5124:function(t,e,i){"use strict";i(1958),i(3737)},470:function(t,e,i){"use strict";i(1958),i(3254)},158:function(t,e,i){"use strict";i(1958),i(368),i(6742),i(3254),i(6911)},6186:function(t,e,i){"use strict";i(1958),i(3737)},2563:function(t,e,i){"use strict";i(1958)},9987:function(t){"use strict";t.exports=JSON.parse('[{"name":"羁梦星愿","gift":"星辰馈赠","gifts":["限定灵犀","动态头像框","点击特效"],"progress":[64,68,72,76,80],"must":[88,95,99],"rewards":[{"id":"120003","count":2,"weight":166},{"id":"coin","count":5000,"remain":38,"weight":100},{"id":"100003","count":100,"remain":18,"weight":100},{"id":"120002","count":3,"remain":28,"weight":100},{"id":"100030","count":40,"remain":39,"weight":100},{"id":"230001","count":100,"remain":9,"weight":145},{"id":"231002","count":1,"remain":38,"weight":100},{"id":"110003","count":1,"remain":18,"weight":100},{"id":"300401","count":10,"remain":30,"weight":100},{"id":"100073","count":1,"remain":28,"weight":100}]},{"name":"羁梦花事","gift":"浮花馈赠","gifts":["限定灵犀","情侣头像","陪伴氛围音"],"progress":[50,55,60,63,66],"must":[72,78,84],"rewards":[{"id":"120003","count":2,"weight":150},{"id":"400001","count":10,"remain":28,"weight":90},{"id":"100003","count":100,"remain":18,"weight":90},{"id":"120002","count":3,"remain":38,"weight":100},{"id":"400002","count":10,"remain":38,"weight":100},{"id":"110003","count":1,"remain":18,"weight":90},{"id":"coin","count":5000,"remain":38,"weight":90},{"id":"231002","count":1,"remain":28,"weight":100},{"id":"400003","count":150,"remain":32,"weight":90},{"id":"230001","count":100,"remain":9,"weight":100}]}]')}}]);
//# sourceMappingURL=990.b7802710.js.map